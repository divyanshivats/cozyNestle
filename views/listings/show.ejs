<% layout("/layouts/boilerplate") %>
<style>
    /* Import Google font - Poppins */
    .star-rating {
        direction: rtl;
        display: inline-block;
     }
     .star-rating input {
        display: none;
     }
     .star-rating label {
        font-size: 2rem;
        color: #ccc;
        cursor: pointer;
     }
     .star-rating input:checked ~ label {
        color: gold;
     }
     .star-rating label:hover,
     .star-rating label:hover ~ label {
        color: gold;
     }
     #map{
        width: 80%;
        height: 400px;
        border: none;
        border-radius: 3rem;
     }
     .features {
        display: flex;
        flex-direction: column;
        gap: 15px;
        margin-bottom: 20px;
    }
    
    .feature {
        display: flex;
        align-items: center;
        gap: 10px;
    }
    
    .icon {
        font-size: 25px;
    }
    
    .feature h4 {
        font-size: 1.1em;
        margin-bottom: 5px;
    }
    
    .feature p {
        color: #666;
    }
    .desc{
        margin-left: 3rem;
    }
    #search{
        font-size: 24px;
    }
    .reviews-section {
        margin-top: 20px;
        text-align: center;
    }
    
    .rating-category {
        display: flex;
        align-items: center;
        gap: 10px;
        margin-top: 10px;
    }
    
    .rating-bar {
        flex: 1;
        height: 8px;
        background-color: #ddd;
        border-radius: 4px;
        position: relative;
    }
    
    .rating-bar span {
        display: block;
        height: 100%;
        background-color: #4CAF50;
        border-radius: 4px;
    }
    
    .rating-details {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 10px;
        margin-top: 15px;
        font-size: 0.9em;
        color: #333;
    }
    .description{
        font-size: 1.2rem;
    }
    
     
</style>
<body>
    

    <div class="row mt-2" >
        <div class="col-8 offset-3">
            <h1><%= listData.title %></h1>
        
        </div>


    
            <div class="card col-6 offset-3 show-card listing-card" >
                <img src="<%= listData.image.url %>" class="card-img-top show-img" alt="listing_img">
                <div class="card-body">
                <p class="card-text">
                    <i>hosted by</i>
                    <% if (listData.owner) { %>
                        <i><%= listData.owner.username %></i>
                    <% } else { %>
                        <i>Owner not available</i>
                    <% } %>
                    
                    <br> 
                    <br>
                    Relax with the whole family at this peaceful play to stay.

                    <br><br><b>The Space</b>
                    <div class="description">
                        <%= listData.description %>
                    </div>
                     <br>
                    <hr>
                    <div class="features">
                        <div class="feature">
                            <span class="icon"><i class="fa-solid fa-door-open"></i></span>
                            <div class="desc">
                                <h4>Self check-in</h4>
                                <p>You can check in with the building staff.</p>
                            </div>
                        </div>
                        <div class="feature">
                            <span class="icon"><i class="fa-solid fa-location-dot"></i></span>
                            <div class="desc">
                                <h4>Unbeatable location</h4>
                                <p>100% of guests in the past year gave this location a 5-star rating.</p>
                            </div>
                        </div>
                        <div class="feature">
                            <span class="icon" id="search"><i class="fa-solid fa-key"></i></span>
                            <div class="desc">
                                <h4>Exceptional check-in experience</h4>
                                <p>Recent guests gave the check-in process a 5-star rating.</p>
                            </div>
                        </div>
                    </div>
                    <hr>
                </p>
                    <br>

                    <div class="row">
                        <h3>What you'll get </h3>
                        
                        <div class="card col-4 ms-3 mb-3 mt-4">
                            <div class="card-body mt-3 mb-3 offset-1">
                                
                                <i class="fa-solid fa-bed"></i> <br>
                                <div class="card-body mt-2"><b>Bedroom</b></div>
                                1 double bed
                            </div>
                        </div>
                        <div class="card col-4 ms-3 mb-3 mt-4">
                            <div class="card-body mt-3 mb-3 offset-1">
                                
                                <i class="fa-solid fa-restroom"></i><br>
                                <div class="card-body mt-2"><b>Restroom</b></div>
                                1 restroom
                            </div>
                        </div>

                    </div>

                    <hr>

                <div class="details">
                    <br>
                    <h5><b>Price</b>&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;:  &nbsp; &#8377;<%= listData.price %></h5> 
                    
                    <h5><b>Location</b> &nbsp; : &nbsp; <%= listData.location %></h5>
                    <h5><b>Country </b> &nbsp; : &nbsp;
                        <%= listData.country %></h5>
                </div>
                </div>
            </div>
    
        
    <% if(currUser){ %>
    <div class="btns mt-1">
        <a href="/listings/<%= listData._id %>/edit" class="btn btn-dark col-1 offset-3">Edit</a>
        <form action="/listings/<%= listData._id %>?_method=DELETE" method="POST">
            <button class="btn btn-dark offset-3">Delete</button>
        </form> <br>
        <a class="reserve-btn btn btn-dark" id="reserve">Reserve</a> 
      
    </div>
    <br> 
    <% } %>
    
    

    

            <!-- Reviews Section -->
            <div class="reviews-section col-5 offset-3 mt-5">
                <br>
                <h3>5.0 Â· 5 reviews</h3>
                <div class="rating-category">
                    <p>Overall rating</p>
                    <div class="rating-bar"><span style="width: 100%;"></span></div>
                    <p>5.0</p>
                </div>
                <div class="rating-details">
                    <div>Cleanliness: 5.0</div>
                    <div>Accuracy: 4.8</div>
                    <div>Check-in: 5.0</div>
                    <div>Communication: 5.0</div>
                    <div>Location: 5.0</div>
                    <div>Value: 5.0</div>
                </div>
            </div>
        </div>
    <br>
   
   
    <div>
        
        <div class="col-8 offset-3">
            <br> 
            
            <% if(currUser) { %>
                <hr>
            <h4>Leave a review</h4>
           
            <form action="/listings/<%= listData._id %>/reviews" method="POST" class="needs-validation" novalidate>
                <label for="rating" class="form-label">Rating</label>
                <div class="star-rating mb-3 mt-3 ">  
                    <input type="radio" name="review[rating]" value="5" id="5"><label for="5" class="fas fa-star"></label>
                    <input type="radio" name="review[rating]" value="4" id="4"><label for="4" class="fas fa-star"></label>
                    <input type="radio" name="review[rating]" value="3" id="3"><label for="3" class="fas fa-star"></label>
                    <input type="radio" name="review[rating]" value="2" id="2"><label for="2" class="fas fa-star"></label>
                    <input type="radio" name="review[rating]" value="1" id="1"><label for="1" class="fas fa-star"></label>
                 </div>
                  

                  
                  
                <div class="mb-3 mt-3">
                    <label for="comment" class="form-label">Comments</label> <br>
                    <textarea 
                    name ="review[comment]" 
                    id="comment" 
                    cols="30" rows="5"
                    class="form-control"
                    required
                    ></textarea>
                </div>
                <br>
                <button class="btn btn-dark">Submit</button>
            
            </form>
            <% } %>

            <br>
            <hr>
            <br>
            <div class="row">
                
                <h4>All Reviews</h4>

                <% for(review of listData.reviews) { %>
                    <div class="card col-6 ms-3 mb-3 mt-4">
                        <div class="card-body mt-2 offset-1">
                            <h5 class="card-title mt-3 mb-2">@<%= review.author.username %></h5>
                            <p class="card-text"><%= review.comment %></p>
                            <p class="card-text">
                                <!-- Render stars based on review.rating -->
                                <% for (let i = 1; i <= 5; i++) { %>
                                    <% if (i <= review.rating) { %>
                                        <i class="fas fa-star" style="color: gold;"></i> <!-- filled star -->
                                    <% } else { %>
                                        <i class="far fa-star" style="color: gold;"></i> <!-- empty star -->
                                    <% } %>
                                <% } %>
                            </p>
                        </div>

     
                        <form action="/listings/<%= listData._id %>/reviews/<%= review._id%>?_method=DELETE" class="mb-3 mt-2" method="POST">
                            <button class="btn btn-dark dlt offset-1 ">Delete</button>
                        </form>
                        <br>
                       
                    </div>
                <% } %>
            </div>
            
           
            
        </div>
        
        <div class="col-8 offset-3 mb-4 mt-3">
            <h3>Where you'll be </h3>
            <br>
            <div id="map">

            </div>
         </div>
    </div>
    
</div>

<script>
    const coordinates = <%= JSON.stringify(listData.geometry.coordinates) %>;
    console.log(coordinates);

	mapboxgl.accessToken = 'pk.eyJ1IjoiZGl2eWFuc2hpdmF0cyIsImEiOiJjbTNmaWNvYmwwNHp1MmlzY2Vlb2k3MWN2In0.mhXDgUytW1X2U1smbn9T0A';
    const map = new mapboxgl.Map({
        container: 'map', // container ID
    
        center: coordinates, // starting position [lng, lat]. Note that lat must be set between -90 and 90
        zoom: 1// starting zoom
    });
    const marker1 = new mapboxgl.Marker({color: "red"})
    .setLngLat(coordinates)
    .addTo(map);

   

    const stars = document.querySelectorAll(".stars i");
    // Loop through the "stars" NodeList
    stars.forEach((star, index1) => {
      // Add an event listener that runs a function when the "click" event is triggered
      star.addEventListener("click", () => {
        // Loop through the "stars" NodeList Again
        stars.forEach((star, index2) => {
          // Add the "active" class to the clicked star and any stars with a lower index
          // and remove the "active" class from any stars with a higher index
          index1 >= index2 ? star.classList.add("active") : star.classList.remove("active");
        });
      });
    });



</script>
</body>  